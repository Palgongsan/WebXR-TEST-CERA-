<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CERA_V11 3D Model Viewer</title>
    
    <!-- Google Model Viewer CDN -->
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            background: black;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        model-viewer {
            width: 100vw;
            height: 100vh;
            background-color: black;
        }

        .animation-controls {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .animation-controls button {
            background: rgba(255, 255, 255, 0.1);
            color: rgb(157, 157, 157);
            border: 1px solid rgba(43, 43, 43, 0.3);
            padding: 8px 8px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: background 0.2s;
        }

        .animation-controls button:hover {
            background: rgba(255,255,255,0.2);
        }

        .animation-controls button.active {
            background: rgba(255,255,255,0.3);
        }
    </style>
</head>
<body>
    <model-viewer
        src="CERA_V11.glb"
        alt="CERA_V11 3D 모델"
        auto-rotate
        camera-controls
        touch-action="pan-y"
        loading="eager"
        reveal="auto"
        environment-image="neutral"
        shadow-intensity="1"
        exposure="1"
        ar
        ar-modes="webxr scene-viewer quick-look"
        ar-scale="auto">
    </model-viewer>
    
    <div class="animation-controls">
        <button onclick="setAnimation('CERA_V11_ChairMode(1)_Baked')">Chair</button>
        <button onclick="setAnimation('CERA_V11_CylinderAction(240)_Baked')">Stretch Anim</button>
        <button onclick="setAnimation('CERA_V11_Stretch(1)_Baked')">Stretch</button>
        <button onclick="setAnimation('')">Pause</button>
    </div>

    <script>
        const modelViewer = document.querySelector('model-viewer');
        let currentAnimation = '';
        
        function setAnimation(animationName) {
            currentAnimation = animationName;
            
            // Remove active class from all buttons
            document.querySelectorAll('.animation-controls button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (animationName) {
                // Set both attribute and property for AR compatibility
                modelViewer.setAttribute('animation-name', animationName);
                modelViewer.animationName = animationName;
                modelViewer.play();
                // Add active class to clicked button
                event.target.classList.add('active');
            } else {
                modelViewer.removeAttribute('animation-name');
                modelViewer.animationName = '';
                modelViewer.pause();
            }
        }
        
        modelViewer.addEventListener('load', () => {
            console.log('Model loaded successfully');
            console.log('Available animations:', modelViewer.availableAnimations);
        });
        
        modelViewer.addEventListener('error', (event) => {
            console.error('Model load failed:', event.detail);
        });
        
        // Enhanced AR animation state preservation
        modelViewer.addEventListener('ar-status', (event) => {
            console.log('AR Status:', event.detail.status);
            
            if (event.detail.status === 'session-started') {
                if (currentAnimation) {
                    // Multiple attempts with different timings for reliability
                    setTimeout(() => {
                        modelViewer.setAttribute('animation-name', currentAnimation);
                        modelViewer.animationName = currentAnimation;
                        modelViewer.play();
                    }, 50);
                    
                    setTimeout(() => {
                        modelViewer.animationName = currentAnimation;
                        modelViewer.play();
                    }, 200);
                    
                    setTimeout(() => {
                        modelViewer.animationName = currentAnimation;
                        modelViewer.play();
                    }, 500);
                }
            }
        });
        
        // Additional event for WebXR sessions
        modelViewer.addEventListener('camera-change', () => {
            if (modelViewer.ar && currentAnimation) {
                modelViewer.animationName = currentAnimation;
                modelViewer.play();
            }
        });
    </script>
</body>
</html>